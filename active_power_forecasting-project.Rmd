---
title: 'Active-power forecasting project '
author: "Yu Wang"
Date: Jan 10 2022
---

## Introduction(Business Scenario)
Renewable energy remains one of the most important topics for a sustainable future.  Wind is one of 
the primary sources of renewable energy. ( https://www.energy.gov/eere/wind/how-do-wind-turbines-
work).  With the rise of wind farms, wind power forecasting has become an important topic.  Utility 
companies need accurate forecasts of the amount of power being produced by wind turbines in order to 
ensure that they have sufficient power available to meet demand.
The attached data set contains information associated with a single wind turbine.  The data were 
collected at 10-minute intervals.  The variables included in the data set are summarized below.

Objective : Create a DAILY forecast for Active Power generation for the turbine for the next 5 day period  (March 31 â€“ April 4, 2020).


## Introduction(Business Scenario )
Date : Date/Time Stamp for each observation 
Year : Year portion of Date 
Month: Month portion of Date 
Day : Day portion of Date 
ActivePower: Active power generated by the wind turbine in kW.  Note that active 
power can be negative.  This occurs when the turbine is absorbing 
power from the grid.
AmbientTermperature: Ambient air temperature in degrees Celsius
WindDirection: Wind direction in degrees from the North
WindSpeed: Wind speed in kmph


## Load Libraries

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(tidymodels)
library(janitor)
library(skimr)
library(kableExtra)
library(GGally)
library(vip)        
library(fastshap)   
library(MASS)
library(ISLR)
library(tree)
library(ggplot2)
library(dplyr)
library(lubridate)
library(imputeTS)
library(forecast)
library(urca)
library(pracma)
library(astsa)
library(fpp2)
library(reshape2)
```

## Load Data

# Import your data with read_csv()

```{r, message=FALSE, warning=FALSE}
turbine <- read_csv("Turbine.csv") %>%
  clean_names()
```
 
 
 
## Exploring the Dataset

```{r}
turbine %>%
  skim_without_charts()
## Active_power has some missing data we need to figure out a way to impute those 
# dataset has100+ row of data and 8 columns 

```


## Data imputation with na_kalman (good way to imputate data with trend and seasonlity)
```{R}

turbine$active_power <-na_kalman(turbine$active_power)
turbine$wind_speed<-na_kalman(turbine$wind_speed)

turbine

```

## Correlation Matrix Between the Variables to find the relation between the active generation and other numeric variables in the dataset

```{r}
numeric_col <- c("active_power", "ambient_temperature", "wind_direction", "wind_speed")

## create numeric_col
turbine %>%
  dplyr::select(all_of(numeric_col)) %>%
  na.omit() %>%
  cor() %>%
  melt %>%
  ggplot(aes(x=Var1, y=Var2, fill=value)) +
  geom_tile() +
  scale_fill_gradient2(mid="#FBFEF9",low="#0C6291",high="#A63446") +
  geom_text(aes(label=round(value, 3)), color="black")
```


## Data Transformation/Aggregation for the total_power and average wind speed

```{r, message=FALSE, warning=FALSE}
options(scipen = 999)

turbine %>%
  group_by(year, month, day) %>%
  summarise(total_power = round(sum(active_power, na.rm = TRUE),2),
            avg_wind_speed = round(mean(wind_speed, na.rm = TRUE), 2)) %>%
  filter(year != 2017) -> turbine_data_transformed

#filter the values of 2017 as there are missing values for the entire year and it's the starting of the values. Therefore, it is better to remove missing values at the starting of the dataset.

turbine_data_transformed
```
## Create time series object and impute the missing values in the time series object
## The current wind speed vector will be used in future in the ARIMA model building

```{r}
# Select the total power and average wind speed

turbine_wind_speed <- subset(turbine_data_transformed, select=-c(month, year, day, total_power))
head(turbine_wind_speed)

# Subsetting the data by keeping only the 'total power' column.
# We could drop all the other one becasue time serles function will automally create the order number for us.

# Create time series object and plot time series
# time series starts at 2018 jan 1st and there is 365 day a year 
wind_speed_ts <- ts(turbine_wind_speed, start=c(2018, 1, 1), frequency = 365)
plot(wind_speed_ts)

```
## from the time series plot we could see that there is not a clear trend but we could see some seasonlity as active power peak during certain month 

## the next step for us to is to test whether series is white nose and whether the series is stationary 

## Ljung box test is a statistical test that checks if autocorrelation exists in a time series, which we use here to test whether series is white noise .

```{r}
# Test for White Noise

Box.test(turbine_data_transformed$total_power, lag=8, fitdf=0, type="Lj")

```

## p value from the Box-Ljung  test is less than 0.05 so we reject the null hypothesis and conclude the series is not white noise, which telling us we need to revise our model a bit before prediction

# Now let's look at whehter the series is stationary, here we using ADF test(Dickey-fuller) for stationarity Using the Single Mean Version of the Test

```{r}

#power_df <- ur.df(power_ts, type = "drift")
#summary(power_df)

```

## p value from the Dickey-fuller test is less than 0.05 so we reject the null hypothesis and conclude the series is stationary 
## Create time series object for forecasting and impute it with moving average

```{r}
# Select the total power and average wind speed

turbine_power <- subset(turbine_data_transformed, select=-c(month, year, day, avg_wind_speed))
head(turbine_power)
# use subset to only keep windpower column and exculde everything else 
# Create time series object and plot time series

power_ts <- ts(turbine_power, start=c(2018, 1, 1), frequency = 365)
# Create time series object and plot time series
# time series starts at 2018 jan 1st and there is 365 day a year 

plot(power_ts)
ggAcf(power_ts)
ggPacf(power_ts)
```
## we see a slow decay in ACF plot. This is indicative of a non-stationary series.And From the PACF plot has a significant spike at lag1 which telling us we probably need to start with a AR 1 model 



## Create an AR(1) model

```{r}
fit_AR1 <- sarima(power_ts, 1, 0, 0)
summary(fit_AR1)
fit_AR1

fit2_AR1 <- arima(power_ts, c(1,0,0))
summary(fit2_AR1)
```
## AR1 did solid as the QQ plot fit a relatively stright line and ACF of residual seems stationary, but the p value are mostly less than 0.05, signifying not white noise.

## Now that's look at an AR(2) model

```{r}
fit_AR2 <- sarima(power_ts, 2, 0, 0)
summary(fit_AR2)
fit_AR1

fit2_AR2 <- arima(power_ts, c(2,0,0))
summary(fit2_AR2)
```
## we still get that a low p value, which telling us we probaly need to tune our model a bit more 

## Now I want to see the effect of differencing. Since we are adding a differcing in the model it might be a good idea to add a MA 1 term to even that out.
#ARIMA model(1, 1, 1) to create a model where Residuals are White Noise

##  

```{r}
fit_model <- sarima(power_ts, 1, 1, 1)
summary(fit_model)
fit_model

fit_model1 <- arima(power_ts, c(1, 1, 1))
summary(fit_model1)

forecast(fit_model1)
autoplot(forecast(fit_model1))

ts.plot(power_ts, fitted(fit_model1), gpars=list(col=c("black","red")))
```
# Here We could see that the p value looks much better 

## Beside Arima, I also want to try out exponential smoothing technique. This tecnique is great for model that is not stationary, with trend and seasonality while ARIMA focuses on the autocorrelations in the data.
## Create a Seasonal Model for comparision with other Sub-Optimal Models
## I used ZNZ for the model is because we don't know if error is additive or multiplcative and there is not a trend in the dataset, and we aren't sure if there is seaonality. 

```{r}
power_ets <- ets(power_ts, model = "ZNZ")
summary(power_ets)
checkresiduals(power_ets)
```



## none of the simple arima model could put an accurate forecast as the forecast plot looks flat, which telling us that we need a seasonal arima model to catch the seasonlity in the dataset. 

## Final Model with the Lowest RMSE, MAPE and most significant terms (at a 5% level) using the paremters from autoarima

```{r}
# The model has all terms significant and due to yearly seasonality, we need to take seasonal difference

fit2_final <- Arima(power_ts, xreg = wind_speed_ts, order=c(2,0,1), seasonal=list(order=c(0,1,0), period=365), include.constant = FALSE)
summary(fit2_final)
checkresiduals(fit2_final)

forecast(fit2_final, xreg=wind_speed_ts)
autoplot(forecast(fit2_final, xreg=wind_speed_ts))

```
## I reduced the RMSE by more than 50% by using a seasonal arima model as the model catching the seasonal pattern existed in the dataset. 

## conclusion: In this project, I have created forecasting model that is capable predicting the seasonlity within the Turbine dataset.I also covered the general steps for creating a simple expoential smoothing model and Arima model.
